# Deployment

**Requirements**

- Deployments on top Docker
- Frontend : [fe-dumbmerch](https://github.com/demo-dumbways/fe-dumbmerch)
- Backend : [be-dumbmerch](https://github.com/demo-dumbways/be-dumbmerch)

**Instructions**

[ *Database* ]

- App database using _PostgreSQL_
- Deploy postgresql on top docker
- Set the volume location in `/home/$USER/`
- Allow database to remote from another server

[ *Application* ]

- Create a Docker image for frontend & backend
- Staging: A lightweight docker image (as small as possible)
- Production: Deploy a production ready app
- Building Docker image on every environment using docker multistage build
- Create load balancing for frontend and backend

## Database Setup menggunakan Elephant Postgres SQL untuk Staging

![alt text](./images/elephantpsql1.png)
![alt text](./images/elephantpsql2.png)
set up databasenya dan taruh di .env nya untuk golang
![alt text](image.png)
![alt text](image-1.png)

## Deploy backend

buat terlebih dahulu dockerfile nya karena aplikasi berjalan di atas docker

```Dockerfile
FROM golang:1.18-alpine AS build

WORKDIR /app

COPY go.mod go.sum ./

RUN go mod tidy

COPY . .

RUN CGO_ENABLED=0 GOOS=linux go build -o backend .

FROM alpine:3.18

WORKDIR /app

COPY --from=build /app/backend .

COPY .env .env

RUN apk --no-cache add ca-certificates tzdata

EXPOSE 5000

ENTRYPOINT ["/app/backend"]

```

untuk deploy di staging sudah pakai CICD dari jenkins jadi tidak perlu manual lagi dan akan langsung di deploy di appserver
